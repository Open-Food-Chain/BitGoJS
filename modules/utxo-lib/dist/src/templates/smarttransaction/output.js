// m [pubKeys ...] n OP_CHECKMULTISIG
var bscript = require('../../script');
var types = require('../../types');
var typeforce = require('typeforce');
var OPS = require('bitcoin-ops');
const networks = require('../../networks');
var OP_INT_BASE = OPS.OP_RESERVED; // OP_1 - 1
function varSliceSize(varSlice) {
    var length = varSlice.length;
    return varuint.encodingLength(length) + length;
}
function getSmartOutputObject(evalCode, optParams) {
    switch (evalCode) {
        case OPS.EVAL_NONE:
            {
                return null;
            }
        case OPS.EVAL_STAKEGUARD:
        case OPS.EVAL_CURRENCY_DEFINITION:
        case OPS.EVAL_NOTARY_EVIDENCE:
        case OPS.EVAL_EARNEDNOTARIZATION:
        case OPS.EVAL_ACCEPTEDNOTARIZATION:
        case OPS.EVAL_FINALIZE_NOTARIZATION:
        case OPS.EVAL_CURRENCYSTATE:
        case OPS.EVAL_RESERVE_TRANSFER:
        case OPS.EVAL_RESERVE_OUTPUT:
        case OPS.EVAL_RESERVE_DEPOSIT:
        case OPS.EVAL_CROSSCHAIN_EXPORT:
        case OPS.EVAL_CROSSCHAIN_IMPORT:
        case OPS.EVAL_IDENTITY_PRIMARY:
        case OPS.EVAL_IDENTITY_COMMITMENT:
        case OPS.EVAL_IDENTITY_RESERVATION:
        case OPS.EVAL_FINALIZE_EXPORT:
        case OPS.EVAL_FEE_POOL:
        case OPS.EVAL_NOTARY_SIGNATURE:
            {
                return optParams.vData[0];
            }
        default:
            {
                return null;
            }
    }
}
class SmartObject {
    constructor(EvalCode, ObjectBuffer) {
        this.evalCode = EvalCode;
        if (ObjectBuffer) {
            this.objectBuffer = ObjectBuffer;
        }
    }
}
/*
* A Verus identity object
*/
class VerusIdentity {
    get VaultVer() {
        return 6;
    }
    get PBaaSVer() {
        return 7;
    }
    get IDVer() {
        return 5;
    }
    IdVersionFromSolution(SolVer) {
        if (SolVer < VaultVer()) {
            return 1;
        }
        else if (SolVer < PBaaSVer()) {
            return 2;
        }
        else {
            return 3;
        }
    }
    constructor(Version = IdVersionFromSolution(IDVer()), Flags = 0, Name = "", Parent, SystemID, PrimaryAddresses, MinSignatures, RevocationID, RecoveryID, ZEndpoints, ContentMap, Timelock) {
        this.version = Version;
        this.flags = Flags;
        this.name = Name;
        if (Parent !== undefined) {
            this.parent = Parent;
        }
        if (SystemID !== undefined) {
            this.systemID = SystemID;
        }
        if (PrimaryAddresses !== undefined) {
            this.primaryaddresses = PrimaryAddresses;
        }
        if (MinSignatures !== undefined) {
            this.minimumsignatures = MinSignatures;
        }
        if (RevocationID !== undefined) {
            this.revocationauthority = RevocationID;
        }
        if (RecoveryID !== undefined) {
            this.recoveryauthority = RecoveryID;
        }
        if (ZEndpoints !== undefined) {
            if (ZEndpoints.length > 1) {
                this.privateaddresses = ZEndpoints;
            }
            this.privateaddress = ZEndpoints[0];
        }
        if (ContentMap !== undefined) {
            this.contentmap = ContentMap;
        }
        if (Timelock !== undefined) {
            this.timelock = Timelock;
        }
    }
}
class VerusCurrencyState {
    constructor() {
    }
}
class VerusCurrencyDefinition {
    constructor() {
    }
}
class VerusPBaaSNotarization {
    constructor() {
    }
}
class VerusProofRoot {
    constructor() {
    }
}
class VerusNativeOutput {
    constructor() {
    }
}
class VerusTokenOutput {
    constructor() {
    }
}
class VerusReserveTransfer {
    constructor() {
    }
}
class VerusExport {
    constructor() {
    }
}
class VerusImport {
    constructor() {
    }
}
class VerusObjectFinalization {
    constructor() {
    }
}
class VerusNotaryEvidence {
    constructor() {
    }
}
class TxDestination {
    get typeInvalid() {
        return 0;
    }
    get typePK() {
        return 1;
    }
    get isPK() {
        return this.destType === this.typePK;
    }
    get typePKH() {
        return 2;
    }
    get isPKH() {
        return this.destType === this.typePKH;
    }
    get typeSH() {
        return 3;
    }
    get isSH() {
        return this.destType === this.typeSH;
    }
    get typeID() {
        return 4;
    }
    get isID() {
        return this.destType === this.typeID;
    }
    get typeIndex() {
        return 5;
    }
    get isIndex() {
        return this.destType === this.typeIndex;
    }
    get typeQuantum() {
        return 6;
    }
    get isQuantum() {
        return this.destType === this.typeQuantum;
    }
    get typeLast() {
        return 6;
    }
    constructor(destType = this.typePKH, destinationBytes = []) {
        this.destType = destType;
        this.destinationBytes = destinationBytes;
    }
    isValid() {
        return this.destType > this.typeInvalid && this.destType <= this.typeLast && this.destinationBytes && this.destinationBytes.length;
    }
    fromBuffer(buffer, initialOffset) {
        var offset = initialOffset || 0;
        function readSlice(n) {
            offset += n;
            return buffer.slice(offset - n, offset);
        }
        function readVarInt() {
            var vi = varuint.decode(buffer, offset);
            offset += varuint.decode.bytes;
            return vi;
        }
        function readVarSlice() {
            return readSlice(readVarInt());
        }
        destByteVector = readVarSlice();
        if (destByteVector.length == 20) {
            this.destType = this.typePKH;
            this.destinationBytes = destByteVector;
        }
        else if (destByteVector.length == 33) {
            this.destType = this.typePK;
            this.destinationBytes = destByteVector;
        }
        else {
            this.destType = destByteVector.slice(0, 1);
            this.destinationBytes = destByteVector.slice(1);
        }
        return offset;
    }
    __byteLength() {
        if (this.destType == this.typePKH) {
            return 20;
        }
        else if (this.destType == this.typePK) {
            return 33;
        }
        else {
            return varuint.encodingLength(this.destinationBytes.length + 1) + this.destinationBytes.length + 1;
        }
    }
    toBuffer(buffer, initialOffset) {
        if (!buffer)
            buffer = Buffer.allocUnsafe(this.__byteLength());
        var offset = initialOffset || 0;
        function writeSlice(slice) { offset += slice.copy(buffer, offset); }
        function writeVarInt(i) {
            varuint.encode(i, buffer, offset);
            offset += varuint.encode.bytes;
        }
        function writeVarSlice(slice) { writeVarInt(slice.length); writeSlice(slice); }
        if (this.destType == this.typePKH) {
            if (this.destinationBytes.length != 20) {
                throw new TypeError('invalid length for typePKH destination bytes');
            }
            writeVarSlice(this.destinationBytes);
        }
        else if (this.destType == this.typePK) {
            if (this.destinationBytes.length != 33) {
                throw new TypeError('invalid length for typePK destination bytes');
            }
            writeVarSlice(this.destinationBytes);
        }
        else {
            combinedVector = [this.destType];
            this.destinationBytes.forEach(x => { combinedVector.push(x); });
            writeVarSlice(combinedVector);
        }
        // avoid slicing unless necessary
        if (initialOffset !== undefined)
            return buffer.slice(initialOffset, offset);
        // TODO (https://github.com/BitGo/bitgo-utxo-lib/issues/11): we shouldn't have to slice the final buffer
        return buffer.slice(0, offset);
    }
}
class OptCCParams {
    constructor(version = 3, evalCode = 0, m = 1, n = 1, destinations = [], serializedObjects = []) {
        this.version = version;
        this.evalCode = evalCode;
        this.m = m;
        this.n = n;
        this.destinations = destinations;
        this.vData = serializedObjects;
    }
    getParamObject() {
        switch (this.evalCode) {
            case OPS.EVAL_NONE:
                {
                    return null;
                }
            case OPS.EVAL_STAKEGUARD:
            case OPS.EVAL_CURRENCY_DEFINITION:
            case OPS.EVAL_NOTARY_EVIDENCE:
            case OPS.EVAL_EARNEDNOTARIZATION:
            case OPS.EVAL_ACCEPTEDNOTARIZATION:
            case OPS.EVAL_FINALIZE_NOTARIZATION:
            case OPS.EVAL_CURRENCYSTATE:
            case OPS.EVAL_RESERVE_TRANSFER:
            case OPS.EVAL_RESERVE_OUTPUT:
            case OPS.EVAL_RESERVE_DEPOSIT:
            case OPS.EVAL_CROSSCHAIN_EXPORT:
            case OPS.EVAL_CROSSCHAIN_IMPORT:
            case OPS.EVAL_IDENTITY_PRIMARY:
            case OPS.EVAL_IDENTITY_COMMITMENT:
            case OPS.EVAL_IDENTITY_RESERVATION:
            case OPS.EVAL_FINALIZE_EXPORT:
            case OPS.EVAL_FEE_POOL:
            case OPS.EVAL_NOTARY_SIGNATURE:
                {
                    if (this.vData.length) {
                        return this.vData[0];
                    }
                    else {
                        return null;
                    }
                }
            default:
                {
                    return null;
                }
        }
    }
    isValid() {
        var validEval = false;
        switch (evalCode) {
            case OPS.EVAL_NONE:
                {
                    validEval = true;
                    break;
                }
            case OPS.EVAL_STAKEGUARD:
            case OPS.EVAL_CURRENCY_DEFINITION:
            case OPS.EVAL_NOTARY_EVIDENCE:
            case OPS.EVAL_EARNEDNOTARIZATION:
            case OPS.EVAL_ACCEPTEDNOTARIZATION:
            case OPS.EVAL_FINALIZE_NOTARIZATION:
            case OPS.EVAL_CURRENCYSTATE:
            case OPS.EVAL_RESERVE_TRANSFER:
            case OPS.EVAL_RESERVE_OUTPUT:
            case OPS.EVAL_RESERVE_DEPOSIT:
            case OPS.EVAL_CROSSCHAIN_EXPORT:
            case OPS.EVAL_CROSSCHAIN_IMPORT:
            case OPS.EVAL_IDENTITY_PRIMARY:
            case OPS.EVAL_IDENTITY_COMMITMENT:
            case OPS.EVAL_IDENTITY_RESERVATION:
            case OPS.EVAL_FINALIZE_EXPORT:
            case OPS.EVAL_FEE_POOL:
            case OPS.EVAL_NOTARY_SIGNATURE:
                {
                    validEval = this.vData && this.vData.length > 0;
                }
        }
        return validEval &&
            this.version > 0 && this.version < 4 && ((this.version < 3 && this.evalCode < 2) ||
            (this.evalCode <= 0x1a && this.m <= this.n && this.destinations.length > 0));
    }
    fromBuffer(buffer, initialOffset) {
        // the first element in this buffer will be a script to decompile and get pushed data from
        var offset = initialOffset || 0;
        function readSlice(n) {
            offset += n;
            return buffer.slice(offset - n, offset);
        }
        function readVarInt() {
            var vi = varuint.decode(buffer, offset);
            offset += varuint.decode.bytes;
            return vi;
        }
        function readVarSlice() {
            return readSlice(readVarInt());
        }
        scriptInVector = readVarSlice();
        chunks = bscript.decompile(scriptInVector);
        if (chunks[0].length != 4) {
            console.log("invalid optional parameters header");
            this.version = 0;
            return offset;
        }
        this.version = chunks[0].readUInt8(0);
        this.evalCode = chunks[0].readUInt8(1);
        this.m = chunks[0].readUInt8(2);
        this.n = chunks[0].readUInt8(3);
        // now, we should have n keys followed by data objects for later versions, otherwise all keys and one data object
        if (this.version <= 0 ||
            this.version > 3 ||
            this.evalCode < 0 ||
            this.evalCode > 0x1a || // this is the last valid eval code as of version 3
            (version < 3 && n < 1) ||
            n > 4 ||
            (version < 3 && n >= chunks.length) ||
            n > chunks.length) {
            console.log("invalid header values", this);
            this.version = 0;
        }
        // now, we have chunks left that are either destinations or data vectors
        limit = this.n == chunks.length ? this.n : this.n + 1;
        this.destinations = [];
        for (loop = 1; this.version && loop < limit; loop++) {
            oneDest = new TxDestination();
            oneDest.fromBuffer(chunks[loop]);
            if (oneDest.isValid()) {
                this.destinations.push(oneDest);
            }
            else {
                this.version = 0;
            }
        }
        for (; this.version && loop < chunks.length; loop++) {
            this.vData.push(chunks[loop]); // is this an issue to just store as is for the data?
        }
        return offset;
    }
    __byteLength() {
        chunks = [Buffer.allocUnsafe(4)];
        chunks[0][0] = this.version;
        chunks[0][1] = this.evalCode;
        chunks[0][2] = this.m;
        chunks[0][3] = this.n;
        this.destinations.forEach(x => {
            chunks.push(Buffer.allocUnsafe(x.__byteLength()));
            x.toBuffer(chunks[chunks.length - 1]);
        });
        this.vData.forEach(x => {
            chunks.push(x);
        });
        return varSliceSize(bscript.compile(chunks));
    }
    toBuffer(buffer, initialOffset) {
        var offset = initialOffset || 0;
        function writeSlice(slice) { offset += slice.copy(buffer, offset); }
        function writeVarInt(i) {
            varuint.encode(i, buffer, offset);
            offset += varuint.encode.bytes;
        }
        function writeVarSlice(slice) { writeVarInt(slice.length); writeSlice(slice); }
        chunks = [Buffer.allocUnsafe(4)];
        chunks[0][0] = this.version;
        chunks[0][1] = this.evalCode;
        chunks[0][2] = this.m;
        chunks[0][3] = this.n;
        this.destinations.forEach(x => {
            chunks.push(Buffer.allocUnsafe(x.__byteLength()));
            x.toBuffer(chunks[chunks.length - 1]);
        });
        this.vData.forEach(x => {
            chunks.push(x);
        });
        scriptStore = bscript.compile(chunks);
        if (!buffer)
            buffer = Buffer.allocUnsafe(varSliceSize(scriptStore));
        writeVarSlice(scriptStore);
        // avoid slicing unless necessary
        if (initialOffset !== undefined)
            return buffer.slice(initialOffset, offset);
        // TODO (https://github.com/BitGo/bitgo-utxo-lib/issues/11): we shouldn't have to slice the final buffer
        return buffer.slice(0, offset);
    }
}
function check(chunks, allowIncomplete) {
    // chunks for a smart transaction should include a push of either a CC or empty/master COptCCParams, then an OP_CHECKCRYPTOCONDITION,
    // then a potentially nested COptCCParams
    // we always start by decoding the second COptCCParams first to determine if the first one should be an opaque CC, as it was
    // in earlier versions. if not, it is added to the end of the data objects of the first params
    if (chunks.length <= 2 ||
        (chunks[chunks.length - 1] !== OPS.OP_CHECKCRYPTOCONDITION && chunks[chunks.length - 1] !== OPS.OP_CHECKCRYPTOCONDITIONVERIFY)) {
        return false;
    }
    optCCParams = new OptCCParams();
    optCCParams.fromBuffer(chunks[2]);
    if (!optCCParams.isValid()) {
        return false;
    }
    // now validate eval codes, object presence, currencies, types, etc.
    return true;
}
check.toJSON = function () { return 'smart transaction output'; };
function encode(m, pubKeys) {
    typeforce({
        m: types.Number,
        pubKeys: [bscript.isCanonicalPubKey]
    }, {
        m: m,
        pubKeys: pubKeys
    });
    var n = pubKeys.length;
    if (n < m)
        throw new TypeError('Not enough pubKeys provided');
    return bscript.compile([].concat(OP_INT_BASE + m, pubKeys, OP_INT_BASE + n, OPS.OP_CHECKMULTISIG));
}
function decode(buffer, allowIncomplete) {
    var chunks = bscript.decompile(buffer);
    typeforce(check, chunks, allowIncomplete);
    return {
        m: chunks[0] - OP_INT_BASE,
        pubKeys: chunks.slice(1, -2)
    };
}
module.exports = {
    check: check,
    decode: decode,
    encode: encode
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3V0cHV0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vc3JjL3RlbXBsYXRlcy9zbWFydHRyYW5zYWN0aW9uL291dHB1dC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxxQ0FBcUM7QUFFckMsSUFBSSxPQUFPLEdBQUcsT0FBTyxDQUFDLGNBQWMsQ0FBQyxDQUFBO0FBQ3JDLElBQUksS0FBSyxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMsQ0FBQTtBQUNsQyxJQUFJLFNBQVMsR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUE7QUFDcEMsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLGFBQWEsQ0FBQyxDQUFBO0FBQ2hDLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFBO0FBQzFDLElBQUksV0FBVyxHQUFHLEdBQUcsQ0FBQyxXQUFXLENBQUEsQ0FBQyxXQUFXO0FBRTdDLFNBQVMsWUFBWSxDQUFDLFFBQVE7SUFFNUIsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLE1BQU0sQ0FBQTtJQUM1QixPQUFPLE9BQU8sQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLEdBQUcsTUFBTSxDQUFBO0FBQ2hELENBQUM7QUFFRCxTQUFTLG9CQUFvQixDQUFDLFFBQVEsRUFBRSxTQUFTO0lBRS9DLFFBQVEsUUFBUSxFQUNoQjtRQUNFLEtBQUssR0FBRyxDQUFDLFNBQVM7WUFDaEI7Z0JBQ0UsT0FBTyxJQUFJLENBQUE7YUFDWjtRQUVILEtBQUssR0FBRyxDQUFDLGVBQWUsQ0FBQztRQUN6QixLQUFLLEdBQUcsQ0FBQyx3QkFBd0IsQ0FBQztRQUNsQyxLQUFLLEdBQUcsQ0FBQyxvQkFBb0IsQ0FBQztRQUM5QixLQUFLLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQztRQUNqQyxLQUFLLEdBQUcsQ0FBQyx5QkFBeUIsQ0FBQztRQUNuQyxLQUFLLEdBQUcsQ0FBQywwQkFBMEIsQ0FBQztRQUNwQyxLQUFLLEdBQUcsQ0FBQyxr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O1FBQUUsTUFBTSxJQUFJLFNBQVMsQ0FBQyw2QkFBNkIsQ0FBQyxDQUFBO0lBRTdELE9BQU8sT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUM5QixXQUFXLEdBQUcsQ0FBQyxFQUNmLE9BQU8sRUFDUCxXQUFXLEdBQUcsQ0FBQyxFQUNmLEdBQUcsQ0FBQyxnQkFBZ0IsQ0FDckIsQ0FBQyxDQUFBO0FBQ0osQ0FBQztBQUVELFNBQVMsTUFBTSxDQUFFLE1BQU0sRUFBRSxlQUFlO0lBQ3RDLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLENBQUE7SUFDdEMsU0FBUyxDQUFDLEtBQUssRUFBRSxNQUFNLEVBQUUsZUFBZSxDQUFDLENBQUE7SUFFekMsT0FBTztRQUNMLENBQUMsRUFBRSxNQUFNLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVztRQUMxQixPQUFPLEVBQUUsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7S0FDN0IsQ0FBQTtBQUNILENBQUM7QUFFRCxNQUFNLENBQUMsT0FBTyxHQUFHO0lBQ2YsS0FBSyxFQUFFLEtBQUs7SUFDWixNQUFNLEVBQUUsTUFBTTtJQUNkLE1BQU0sRUFBRSxNQUFNO0NBQ2YsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8vIG0gW3B1YktleXMgLi4uXSBuIE9QX0NIRUNLTVVMVElTSUdcblxudmFyIGJzY3JpcHQgPSByZXF1aXJlKCcuLi8uLi9zY3JpcHQnKVxudmFyIHR5cGVzID0gcmVxdWlyZSgnLi4vLi4vdHlwZXMnKVxudmFyIHR5cGVmb3JjZSA9IHJlcXVpcmUoJ3R5cGVmb3JjZScpXG52YXIgT1BTID0gcmVxdWlyZSgnYml0Y29pbi1vcHMnKVxuY29uc3QgbmV0d29ya3MgPSByZXF1aXJlKCcuLi8uLi9uZXR3b3JrcycpXG52YXIgT1BfSU5UX0JBU0UgPSBPUFMuT1BfUkVTRVJWRUQgLy8gT1BfMSAtIDFcblxuZnVuY3Rpb24gdmFyU2xpY2VTaXplKHZhclNsaWNlKVxue1xuICB2YXIgbGVuZ3RoID0gdmFyU2xpY2UubGVuZ3RoXG4gIHJldHVybiB2YXJ1aW50LmVuY29kaW5nTGVuZ3RoKGxlbmd0aCkgKyBsZW5ndGhcbn1cblxuZnVuY3Rpb24gZ2V0U21hcnRPdXRwdXRPYmplY3QoZXZhbENvZGUsIG9wdFBhcmFtcylcbntcbiAgc3dpdGNoIChldmFsQ29kZSlcbiAge1xuICAgIGNhc2UgT1BTLkVWQUxfTk9ORTpcbiAgICAgIHtcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cblxuICAgIGNhc2UgT1BTLkVWQUxfU1RBS0VHVUFSRDpcbiAgICBjYXNlIE9QUy5FVkFMX0NVUlJFTkNZX0RFRklOSVRJT046XG4gICAgY2FzZSBPUFMuRVZBTF9OT1RBUllfRVZJREVOQ0U6XG4gICAgY2FzZSBPUFMuRVZBTF9FQVJORUROT1RBUklaQVRJT046XG4gICAgY2FzZSBPUFMuRVZBTF9BQ0NFUFRFRE5PVEFSSVpBVElPTjpcbiAgICBjYXNlIE9QUy5FVkFMX0ZJTkFMSVpFX05PVEFSSVpBVElPTjpcbiAgICBjYXNlIE9QUy5FVkFMX0NVUlJFTkNZU1RBVEU6XG4gICAgY2FzZSBPUFMuRVZBTF9SRVNFUlZFX1RSQU5TRkVSOlxuICAgIGNhc2UgT1BTLkVWQUxfUkVTRVJWRV9PVVRQVVQ6XG4gICAgY2FzZSBPUFMuRVZBTF9SRVNFUlZFX0RFUE9TSVQ6XG4gICAgY2FzZSBPUFMuRVZBTF9DUk9TU0NIQUlOX0VYUE9SVDpcbiAgICBjYXNlIE9QUy5FVkFMX0NST1NTQ0hBSU5fSU1QT1JUOlxuICAgIGNhc2UgT1BTLkVWQUxfSURFTlRJVFlfUFJJTUFSWTpcbiAgICBjYXNlIE9QUy5FVkFMX0lERU5USVRZX0NPTU1JVE1FTlQ6XG4gICAgY2FzZSBPUFMuRVZBTF9JREVOVElUWV9SRVNFUlZBVElPTjpcbiAgICBjYXNlIE9QUy5FVkFMX0ZJTkFMSVpFX0VYUE9SVDpcbiAgICBjYXNlIE9QUy5FVkFMX0ZFRV9QT09MOlxuICAgIGNhc2UgT1BTLkVWQUxfTk9UQVJZX1NJR05BVFVSRTpcbiAgICAgIHtcbiAgICAgICAgcmV0dXJuIG9wdFBhcmFtcy52RGF0YVswXVxuICAgICAgfVxuXG4gICAgZGVmYXVsdDpcbiAgICAgIHtcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cbiAgfVxufVxuXG5jbGFzcyBTbWFydE9iamVjdFxue1xuICBjb25zdHJ1Y3RvcihFdmFsQ29kZSwgT2JqZWN0QnVmZmVyKVxuICB7XG4gICAgdGhpcy5ldmFsQ29kZSA9IEV2YWxDb2RlXG4gICAgaWYgKE9iamVjdEJ1ZmZlcilcbiAgICB7XG4gICAgICB0aGlzLm9iamVjdEJ1ZmZlciA9IE9iamVjdEJ1ZmZlclxuICAgIH1cbiAgfVxufVxuXG4vKlxuKiBBIFZlcnVzIGlkZW50aXR5IG9iamVjdFxuKi9cbmNsYXNzIFZlcnVzSWRlbnRpdHlcbntcbiAgZ2V0IFZhdWx0VmVyKClcbiAge1xuICAgIHJldHVybiA2XG4gIH1cblxuICBnZXQgUEJhYVNWZXIoKVxuICB7XG4gICAgcmV0dXJuIDdcbiAgfVxuXG4gIGdldCBJRFZlcigpXG4gIHtcbiAgICByZXR1cm4gNVxuICB9XG5cbiAgSWRWZXJzaW9uRnJvbVNvbHV0aW9uKFNvbFZlcilcbiAge1xuICAgIGlmIChTb2xWZXIgPCBWYXVsdFZlcigpKVxuICAgIHtcbiAgICAgIHJldHVybiAxXG4gICAgfVxuICAgIGVsc2UgaWYgKFNvbFZlciA8IFBCYWFTVmVyKCkpXG4gICAge1xuICAgICAgcmV0dXJuIDI7XG4gICAgfVxuICAgIGVsc2VcbiAgICB7XG4gICAgICByZXR1cm4gMztcbiAgICB9XG4gIH1cblxuICBjb25zdHJ1Y3RvcihWZXJzaW9uID0gSWRWZXJzaW9uRnJvbVNvbHV0aW9uKElEVmVyKCkpLCBGbGFncz0wLCBOYW1lPVwiXCIsIFBhcmVudCwgU3lzdGVtSUQsIFByaW1hcnlBZGRyZXNzZXMsIE1pblNpZ25hdHVyZXMsIFJldm9jYXRpb25JRCwgUmVjb3ZlcnlJRCwgWkVuZHBvaW50cywgQ29udGVudE1hcCwgVGltZWxvY2spXG4gIHtcbiAgICB0aGlzLnZlcnNpb24gPSBWZXJzaW9uXG4gICAgdGhpcy5mbGFncyA9IEZsYWdzXG4gICAgdGhpcy5uYW1lID0gTmFtZVxuICAgIGlmIChQYXJlbnQgIT09IHVuZGVmaW5lZClcbiAgICB7XG4gICAgICB0aGlzLnBhcmVudCA9IFBhcmVudFxuICAgIH1cbiAgICBpZiAoU3lzdGVtSUQgIT09IHVuZGVmaW5lZClcbiAgICB7XG4gICAgICB0aGlzLnN5c3RlbUlEID0gU3lzdGVtSURcbiAgICB9XG4gICAgaWYgKFByaW1hcnlBZGRyZXNzZXMgIT09IHVuZGVmaW5lZClcbiAgICB7XG4gICAgICB0aGlzLnByaW1hcnlhZGRyZXNzZXMgPSBQcmltYXJ5QWRkcmVzc2VzXG4gICAgfVxuICAgIGlmIChNaW5TaWduYXR1cmVzICE9PSB1bmRlZmluZWQpXG4gICAge1xuICAgICAgdGhpcy5taW5pbXVtc2lnbmF0dXJlcyA9IE1pblNpZ25hdHVyZXNcbiAgICB9XG4gICAgaWYgKFJldm9jYXRpb25JRCAhPT0gdW5kZWZpbmVkKVxuICAgIHtcbiAgICAgIHRoaXMucmV2b2NhdGlvbmF1dGhvcml0eSA9IFJldm9jYXRpb25JRFxuICAgIH1cbiAgICBpZiAoUmVjb3ZlcnlJRCAhPT0gdW5kZWZpbmVkKVxuICAgIHtcbiAgICAgIHRoaXMucmVjb3ZlcnlhdXRob3JpdHkgPSBSZWNvdmVyeUlEXG4gICAgfVxuICAgIGlmIChaRW5kcG9pbnRzICE9PSB1bmRlZmluZWQpXG4gICAge1xuICAgICAgaWYgKFpFbmRwb2ludHMubGVuZ3RoID4gMSlcbiAgICAgIHtcbiAgICAgICAgdGhpcy5wcml2YXRlYWRkcmVzc2VzID0gWkVuZHBvaW50c1xuICAgICAgfVxuICAgICAgdGhpcy5wcml2YXRlYWRkcmVzcyA9IFpFbmRwb2ludHNbMF1cbiAgICB9XG4gICAgaWYgKENvbnRlbnRNYXAgIT09IHVuZGVmaW5lZClcbiAgICB7XG4gICAgICB0aGlzLmNvbnRlbnRtYXAgPSBDb250ZW50TWFwXG4gICAgfVxuICAgIGlmIChUaW1lbG9jayAhPT0gdW5kZWZpbmVkKVxuICAgIHtcbiAgICAgIHRoaXMudGltZWxvY2sgPSBUaW1lbG9ja1xuICAgIH1cbiAgfVxuXG5cbn1cblxuY2xhc3MgVmVydXNDdXJyZW5jeVN0YXRlXG57XG4gIGNvbnN0cnVjdG9yKClcbiAge1xuXG4gIH1cbn1cblxuY2xhc3MgVmVydXNDdXJyZW5jeURlZmluaXRpb25cbntcbiAgY29uc3RydWN0b3IoKVxuICB7XG4gICAgXG4gIH1cbn1cblxuY2xhc3MgVmVydXNQQmFhU05vdGFyaXphdGlvblxue1xuICBjb25zdHJ1Y3RvcigpXG4gIHtcbiAgICBcbiAgfVxufVxuXG5jbGFzcyBWZXJ1c1Byb29mUm9vdFxue1xuICBjb25zdHJ1Y3RvcigpXG4gIHtcbiAgICBcbiAgfVxufVxuXG5jbGFzcyBWZXJ1c05hdGl2ZU91dHB1dFxue1xuICBjb25zdHJ1Y3RvcigpXG4gIHtcbiAgICBcbiAgfVxufVxuXG5jbGFzcyBWZXJ1c1Rva2VuT3V0cHV0XG57XG4gIGNvbnN0cnVjdG9yKClcbiAge1xuICAgIFxuICB9XG59XG5cbmNsYXNzIFZlcnVzUmVzZXJ2ZVRyYW5zZmVyXG57XG4gIGNvbnN0cnVjdG9yKClcbiAge1xuICAgIFxuICB9XG59XG5cbmNsYXNzIFZlcnVzRXhwb3J0XG57XG4gIGNvbnN0cnVjdG9yKClcbiAge1xuICAgIFxuICB9XG59XG5cbmNsYXNzIFZlcnVzSW1wb3J0XG57XG4gIGNvbnN0cnVjdG9yKClcbiAge1xuICAgIFxuICB9XG59XG5cbmNsYXNzIFZlcnVzT2JqZWN0RmluYWxpemF0aW9uXG57XG4gIGNvbnN0cnVjdG9yKClcbiAge1xuICAgIFxuICB9XG59XG5cbmNsYXNzIFZlcnVzTm90YXJ5RXZpZGVuY2VcbntcbiAgY29uc3RydWN0b3IoKVxuICB7XG4gICAgXG4gIH1cbn1cblxuY2xhc3MgVHhEZXN0aW5hdGlvblxue1xuICBnZXQgdHlwZUludmFsaWQoKVxuICB7XG4gICAgcmV0dXJuIDBcbiAgfVxuICBnZXQgdHlwZVBLKClcbiAge1xuICAgIHJldHVybiAxXG4gIH1cbiAgZ2V0IGlzUEsoKVxuICB7XG4gICAgcmV0dXJuIHRoaXMuZGVzdFR5cGUgPT09IHRoaXMudHlwZVBLXG4gIH1cbiAgZ2V0IHR5cGVQS0goKVxuICB7XG4gICAgcmV0dXJuIDJcbiAgfVxuICBnZXQgaXNQS0goKVxuICB7XG4gICAgcmV0dXJuIHRoaXMuZGVzdFR5cGUgPT09IHRoaXMudHlwZVBLSFxuICB9XG4gIGdldCB0eXBlU0goKVxuICB7XG4gICAgcmV0dXJuIDNcbiAgfVxuICBnZXQgaXNTSCgpXG4gIHtcbiAgICByZXR1cm4gdGhpcy5kZXN0VHlwZSA9PT0gdGhpcy50eXBlU0hcbiAgfVxuICBnZXQgdHlwZUlEKClcbiAge1xuICAgIHJldHVybiA0XG4gIH1cbiAgZ2V0IGlzSUQoKVxuICB7XG4gICAgcmV0dXJuIHRoaXMuZGVzdFR5cGUgPT09IHRoaXMudHlwZUlEXG4gIH1cbiAgZ2V0IHR5cGVJbmRleCgpXG4gIHtcbiAgICByZXR1cm4gNVxuICB9XG4gIGdldCBpc0luZGV4KClcbiAge1xuICAgIHJldHVybiB0aGlzLmRlc3RUeXBlID09PSB0aGlzLnR5cGVJbmRleFxuICB9XG4gIGdldCB0eXBlUXVhbnR1bSgpXG4gIHtcbiAgICByZXR1cm4gNlxuICB9XG4gIGdldCBpc1F1YW50dW0oKVxuICB7XG4gICAgcmV0dXJuIHRoaXMuZGVzdFR5cGUgPT09IHRoaXMudHlwZVF1YW50dW1cbiAgfVxuICBnZXQgdHlwZUxhc3QoKVxuICB7XG4gICAgcmV0dXJuIDZcbiAgfVxuICBjb25zdHJ1Y3RvcihkZXN0VHlwZT10aGlzLnR5cGVQS0gsIGRlc3RpbmF0aW9uQnl0ZXM9W10pXG4gIHtcbiAgICB0aGlzLmRlc3RUeXBlID0gZGVzdFR5cGVcbiAgICB0aGlzLmRlc3RpbmF0aW9uQnl0ZXMgPSBkZXN0aW5hdGlvbkJ5dGVzXG4gIH1cblxuICBpc1ZhbGlkKClcbiAge1xuICAgIHJldHVybiB0aGlzLmRlc3RUeXBlID4gdGhpcy50eXBlSW52YWxpZCAmJiB0aGlzLmRlc3RUeXBlIDw9IHRoaXMudHlwZUxhc3QgJiYgdGhpcy5kZXN0aW5hdGlvbkJ5dGVzICYmIHRoaXMuZGVzdGluYXRpb25CeXRlcy5sZW5ndGhcbiAgfVxuXG4gIGZyb21CdWZmZXIoYnVmZmVyLCBpbml0aWFsT2Zmc2V0KVxuICB7XG4gICAgdmFyIG9mZnNldCA9IGluaXRpYWxPZmZzZXQgfHwgMFxuICAgIGZ1bmN0aW9uIHJlYWRTbGljZSAobikge1xuICAgICAgb2Zmc2V0ICs9IG5cbiAgICAgIHJldHVybiBidWZmZXIuc2xpY2Uob2Zmc2V0IC0gbiwgb2Zmc2V0KVxuICAgIH1cbiAgXG4gICAgZnVuY3Rpb24gcmVhZFZhckludCAoKSB7XG4gICAgICB2YXIgdmkgPSB2YXJ1aW50LmRlY29kZShidWZmZXIsIG9mZnNldClcbiAgICAgIG9mZnNldCArPSB2YXJ1aW50LmRlY29kZS5ieXRlc1xuICAgICAgcmV0dXJuIHZpXG4gICAgfVxuICBcbiAgICBmdW5jdGlvbiByZWFkVmFyU2xpY2UgKCkge1xuICAgICAgcmV0dXJuIHJlYWRTbGljZShyZWFkVmFySW50KCkpXG4gICAgfVxuICBcbiAgICBkZXN0Qnl0ZVZlY3RvciA9IHJlYWRWYXJTbGljZSgpXG4gICAgaWYgKGRlc3RCeXRlVmVjdG9yLmxlbmd0aCA9PSAyMClcbiAgICB7XG4gICAgICB0aGlzLmRlc3RUeXBlID0gdGhpcy50eXBlUEtIXG4gICAgICB0aGlzLmRlc3RpbmF0aW9uQnl0ZXMgPSBkZXN0Qnl0ZVZlY3RvclxuICAgIH1cbiAgICBlbHNlIGlmIChkZXN0Qnl0ZVZlY3Rvci5sZW5ndGggPT0gMzMpXG4gICAge1xuICAgICAgdGhpcy5kZXN0VHlwZSA9IHRoaXMudHlwZVBLXG4gICAgICB0aGlzLmRlc3RpbmF0aW9uQnl0ZXMgPSBkZXN0Qnl0ZVZlY3RvclxuICAgIH1cbiAgICBlbHNlXG4gICAge1xuICAgICAgdGhpcy5kZXN0VHlwZSA9IGRlc3RCeXRlVmVjdG9yLnNsaWNlKDAsIDEpXG4gICAgICB0aGlzLmRlc3RpbmF0aW9uQnl0ZXMgPSBkZXN0Qnl0ZVZlY3Rvci5zbGljZSgxKVxuICAgIH1cbiAgICByZXR1cm4gb2Zmc2V0XG4gIH1cblxuICBfX2J5dGVMZW5ndGgoKVxuICB7XG4gICAgaWYgKHRoaXMuZGVzdFR5cGUgPT0gdGhpcy50eXBlUEtIKVxuICAgIHtcbiAgICAgIHJldHVybiAyMDtcbiAgICB9XG4gICAgZWxzZSBpZiAodGhpcy5kZXN0VHlwZSA9PSB0aGlzLnR5cGVQSylcbiAgICB7XG4gICAgICByZXR1cm4gMzNcbiAgICB9XG4gICAgZWxzZVxuICAgIHtcbiAgICAgIHJldHVybiB2YXJ1aW50LmVuY29kaW5nTGVuZ3RoKHRoaXMuZGVzdGluYXRpb25CeXRlcy5sZW5ndGggKyAxKSArIHRoaXMuZGVzdGluYXRpb25CeXRlcy5sZW5ndGggKyAxXG4gICAgfVxuICB9XG5cbiAgdG9CdWZmZXIoYnVmZmVyLCBpbml0aWFsT2Zmc2V0KVxuICB7XG4gICAgaWYgKCFidWZmZXIpIGJ1ZmZlciA9IEJ1ZmZlci5hbGxvY1Vuc2FmZSh0aGlzLl9fYnl0ZUxlbmd0aCgpKVxuICAgIHZhciBvZmZzZXQgPSBpbml0aWFsT2Zmc2V0IHx8IDBcbiAgICBmdW5jdGlvbiB3cml0ZVNsaWNlIChzbGljZSkgeyBvZmZzZXQgKz0gc2xpY2UuY29weShidWZmZXIsIG9mZnNldCkgfVxuICAgIGZ1bmN0aW9uIHdyaXRlVmFySW50IChpKSB7XG4gICAgICB2YXJ1aW50LmVuY29kZShpLCBidWZmZXIsIG9mZnNldClcbiAgICAgIG9mZnNldCArPSB2YXJ1aW50LmVuY29kZS5ieXRlc1xuICAgIH1cbiAgICBmdW5jdGlvbiB3cml0ZVZhclNsaWNlIChzbGljZSkgeyB3cml0ZVZhckludChzbGljZS5sZW5ndGgpOyB3cml0ZVNsaWNlKHNsaWNlKSB9XG5cbiAgICBpZiAodGhpcy5kZXN0VHlwZSA9PSB0aGlzLnR5cGVQS0gpXG4gICAge1xuICAgICAgaWYgKHRoaXMuZGVzdGluYXRpb25CeXRlcy5sZW5ndGggIT0gMjApXG4gICAgICB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ2ludmFsaWQgbGVuZ3RoIGZvciB0eXBlUEtIIGRlc3RpbmF0aW9uIGJ5dGVzJylcbiAgICAgIH1cbiAgICAgIHdyaXRlVmFyU2xpY2UodGhpcy5kZXN0aW5hdGlvbkJ5dGVzKVxuICAgIH1cbiAgICBlbHNlIGlmICh0aGlzLmRlc3RUeXBlID09IHRoaXMudHlwZVBLKVxuICAgIHtcbiAgICAgIGlmICh0aGlzLmRlc3RpbmF0aW9uQnl0ZXMubGVuZ3RoICE9IDMzKVxuICAgICAge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdpbnZhbGlkIGxlbmd0aCBmb3IgdHlwZVBLIGRlc3RpbmF0aW9uIGJ5dGVzJylcbiAgICAgIH1cbiAgICAgIHdyaXRlVmFyU2xpY2UodGhpcy5kZXN0aW5hdGlvbkJ5dGVzKVxuICAgIH1cbiAgICBlbHNlXG4gICAge1xuICAgICAgY29tYmluZWRWZWN0b3IgPSBbdGhpcy5kZXN0VHlwZV1cbiAgICAgIHRoaXMuZGVzdGluYXRpb25CeXRlcy5mb3JFYWNoKHggPT4geyBjb21iaW5lZFZlY3Rvci5wdXNoKHgpIH0pXG4gICAgICB3cml0ZVZhclNsaWNlKGNvbWJpbmVkVmVjdG9yKVxuICAgIH1cblxuICAgIC8vIGF2b2lkIHNsaWNpbmcgdW5sZXNzIG5lY2Vzc2FyeVxuICAgIGlmIChpbml0aWFsT2Zmc2V0ICE9PSB1bmRlZmluZWQpIHJldHVybiBidWZmZXIuc2xpY2UoaW5pdGlhbE9mZnNldCwgb2Zmc2V0KVxuICAgIC8vIFRPRE8gKGh0dHBzOi8vZ2l0aHViLmNvbS9CaXRHby9iaXRnby11dHhvLWxpYi9pc3N1ZXMvMTEpOiB3ZSBzaG91bGRuJ3QgaGF2ZSB0byBzbGljZSB0aGUgZmluYWwgYnVmZmVyXG4gICAgcmV0dXJuIGJ1ZmZlci5zbGljZSgwLCBvZmZzZXQpICAgIFxuICB9XG59XG5cbmNsYXNzIE9wdENDUGFyYW1zXG57XG4gIGNvbnN0cnVjdG9yKHZlcnNpb249MywgZXZhbENvZGU9MCwgbT0xLCBuPTEsIGRlc3RpbmF0aW9ucz1bXSwgc2VyaWFsaXplZE9iamVjdHM9W10pXG4gIHtcbiAgICB0aGlzLnZlcnNpb24gPSB2ZXJzaW9uXG4gICAgdGhpcy5ldmFsQ29kZSA9IGV2YWxDb2RlXG4gICAgdGhpcy5tID0gbVxuICAgIHRoaXMubiA9IG5cbiAgICB0aGlzLmRlc3RpbmF0aW9ucyA9IGRlc3RpbmF0aW9uc1xuICAgIHRoaXMudkRhdGEgPSBzZXJpYWxpemVkT2JqZWN0c1xuICB9XG5cbiAgZ2V0UGFyYW1PYmplY3QoKVxuICB7XG4gICAgc3dpdGNoICh0aGlzLmV2YWxDb2RlKVxuICAgIHtcbiAgICAgIGNhc2UgT1BTLkVWQUxfTk9ORTpcbiAgICAgICAge1xuICAgICAgICAgIHJldHVybiBudWxsXG4gICAgICAgIH1cbiAgXG4gICAgICBjYXNlIE9QUy5FVkFMX1NUQUtFR1VBUkQ6XG4gICAgICBjYXNlIE9QUy5FVkFMX0NVUlJFTkNZX0RFRklOSVRJT046XG4gICAgICBjYXNlIE9QUy5FVkFMX05PVEFSWV9FVklERU5DRTpcbiAgICAgIGNhc2UgT1BTLkVWQUxfRUFSTkVETk9UQVJJWkFUSU9OOlxuICAgICAgY2FzZSBPUFMuRVZBTF9BQ0NFUFRFRE5PVEFSSVpBVElPTjpcbiAgICAgIGNhc2UgT1BTLkVWQUxfRklOQUxJWkVfTk9UQVJJWkFUSU9OOlxuICAgICAgY2FzZSBPUFMuRVZBTF9DVVJSRU5DWVNUQVRFOlxuICAgICAgY2FzZSBPUFMuRVZBTF9SRVNFUlZFX1RSQU5TRkVSOlxuICAgICAgY2FzZSBPUFMuRVZBTF9SRVNFUlZFX09VVFBVVDpcbiAgICAgIGNhc2UgT1BTLkVWQUxfUkVTRVJWRV9ERVBPU0lUOlxuICAgICAgY2FzZSBPUFMuRVZBTF9DUk9TU0NIQUlOX0VYUE9SVDpcbiAgICAgIGNhc2UgT1BTLkVWQUxfQ1JPU1NDSEFJTl9JTVBPUlQ6XG4gICAgICBjYXNlIE9QUy5FVkFMX0lERU5USVRZX1BSSU1BUlk6XG4gICAgICBjYXNlIE9QUy5FVkFMX0lERU5USVRZX0NPTU1JVE1FTlQ6XG4gICAgICBjYXNlIE9QUy5FVkFMX0lERU5USVRZX1JFU0VSVkFUSU9OOlxuICAgICAgY2FzZSBPUFMuRVZBTF9GSU5BTElaRV9FWFBPUlQ6XG4gICAgICBjYXNlIE9QUy5FVkFMX0ZFRV9QT09MOlxuICAgICAgY2FzZSBPUFMuRVZBTF9OT1RBUllfU0lHTkFUVVJFOlxuICAgICAgICB7XG4gICAgICAgICAgaWYgKHRoaXMudkRhdGEubGVuZ3RoKVxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnZEYXRhWzBdXG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2VcbiAgICAgICAgICB7XG4gICAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICBcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIHtcbiAgICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgICB9XG4gICAgfVxuICB9XG4gIFxuICBpc1ZhbGlkKClcbiAge1xuICAgIHZhciB2YWxpZEV2YWwgPSBmYWxzZTtcbiAgICBzd2l0Y2ggKGV2YWxDb2RlKVxuICAgIHtcbiAgICAgIGNhc2UgT1BTLkVWQUxfTk9ORTpcbiAgICAgICAge1xuICAgICAgICAgIHZhbGlkRXZhbCA9IHRydWVcbiAgICAgICAgICBicmVha1xuICAgICAgICB9XG5cbiAgICAgIGNhc2UgT1BTLkVWQUxfU1RBS0VHVUFSRDpcbiAgICAgIGNhc2UgT1BTLkVWQUxfQ1VSUkVOQ1lfREVGSU5JVElPTjpcbiAgICAgIGNhc2UgT1BTLkVWQUxfTk9UQVJZX0VWSURFTkNFOlxuICAgICAgY2FzZSBPUFMuRVZBTF9FQVJORUROT1RBUklaQVRJT046XG4gICAgICBjYXNlIE9QUy5FVkFMX0FDQ0VQVEVETk9UQVJJWkFUSU9OOlxuICAgICAgY2FzZSBPUFMuRVZBTF9GSU5BTElaRV9OT1RBUklaQVRJT046XG4gICAgICBjYXNlIE9QUy5FVkFMX0NVUlJFTkNZU1RBVEU6XG4gICAgICBjYXNlIE9QUy5FVkFMX1JFU0VSVkVfVFJBTlNGRVI6XG4gICAgICBjYXNlIE9QUy5FVkFMX1JFU0VSVkVfT1VUUFVUOlxuICAgICAgY2FzZSBPUFMuRVZBTF9SRVNFUlZFX0RFUE9TSVQ6XG4gICAgICBjYXNlIE9QUy5FVkFMX0NST1NTQ0hBSU5fRVhQT1JUOlxuICAgICAgY2FzZSBPUFMuRVZBTF9DUk9TU0NIQUlOX0lNUE9SVDpcbiAgICAgIGNhc2UgT1BTLkVWQUxfSURFTlRJVFlfUFJJTUFSWTpcbiAgICAgIGNhc2UgT1BTLkVWQUxfSURFTlRJVFlfQ09NTUlUTUVOVDpcbiAgICAgIGNhc2UgT1BTLkVWQUxfSURFTlRJVFlfUkVTRVJWQVRJT046XG4gICAgICBjYXNlIE9QUy5FVkFMX0ZJTkFMSVpFX0VYUE9SVDpcbiAgICAgIGNhc2UgT1BTLkVWQUxfRkVFX1BPT0w6XG4gICAgICBjYXNlIE9QUy5FVkFMX05PVEFSWV9TSUdOQVRVUkU6XG4gICAgICAgIHtcbiAgICAgICAgICB2YWxpZEV2YWwgPSB0aGlzLnZEYXRhICYmIHRoaXMudkRhdGEubGVuZ3RoID4gMFxuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiB2YWxpZEV2YWwgJiZcbiAgICAgICAgICAgdGhpcy52ZXJzaW9uID4gMCAmJiB0aGlzLnZlcnNpb24gPCA0ICYmICgodGhpcy52ZXJzaW9uIDwgMyAmJiB0aGlzLmV2YWxDb2RlIDwgMikgfHwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKHRoaXMuZXZhbENvZGUgPD0gMHgxYSAmJiB0aGlzLm0gPD0gdGhpcy5uICYmIHRoaXMuZGVzdGluYXRpb25zLmxlbmd0aCA+IDApKVxuICB9XG5cbiAgZnJvbUJ1ZmZlcihidWZmZXIsIGluaXRpYWxPZmZzZXQpXG4gIHtcbiAgICAvLyB0aGUgZmlyc3QgZWxlbWVudCBpbiB0aGlzIGJ1ZmZlciB3aWxsIGJlIGEgc2NyaXB0IHRvIGRlY29tcGlsZSBhbmQgZ2V0IHB1c2hlZCBkYXRhIGZyb21cbiAgICB2YXIgb2Zmc2V0ID0gaW5pdGlhbE9mZnNldCB8fCAwXG4gICAgZnVuY3Rpb24gcmVhZFNsaWNlIChuKSB7XG4gICAgICBvZmZzZXQgKz0gblxuICAgICAgcmV0dXJuIGJ1ZmZlci5zbGljZShvZmZzZXQgLSBuLCBvZmZzZXQpXG4gICAgfVxuICBcbiAgICBmdW5jdGlvbiByZWFkVmFySW50ICgpIHtcbiAgICAgIHZhciB2aSA9IHZhcnVpbnQuZGVjb2RlKGJ1ZmZlciwgb2Zmc2V0KVxuICAgICAgb2Zmc2V0ICs9IHZhcnVpbnQuZGVjb2RlLmJ5dGVzXG4gICAgICByZXR1cm4gdmlcbiAgICB9XG4gIFxuICAgIGZ1bmN0aW9uIHJlYWRWYXJTbGljZSAoKSB7XG4gICAgICByZXR1cm4gcmVhZFNsaWNlKHJlYWRWYXJJbnQoKSlcbiAgICB9XG4gIFxuICAgIHNjcmlwdEluVmVjdG9yID0gcmVhZFZhclNsaWNlKClcbiAgICBjaHVua3MgPSBic2NyaXB0LmRlY29tcGlsZShzY3JpcHRJblZlY3RvcilcblxuICAgIGlmIChjaHVua3NbMF0ubGVuZ3RoICE9IDQpXG4gICAge1xuICAgICAgY29uc29sZS5sb2coXCJpbnZhbGlkIG9wdGlvbmFsIHBhcmFtZXRlcnMgaGVhZGVyXCIpXG4gICAgICB0aGlzLnZlcnNpb24gPSAwXG4gICAgICByZXR1cm4gb2Zmc2V0XG4gICAgfVxuXG4gICAgdGhpcy52ZXJzaW9uID0gY2h1bmtzWzBdLnJlYWRVSW50OCgwKVxuICAgIHRoaXMuZXZhbENvZGUgPSBjaHVua3NbMF0ucmVhZFVJbnQ4KDEpXG4gICAgdGhpcy5tID0gY2h1bmtzWzBdLnJlYWRVSW50OCgyKVxuICAgIHRoaXMubiA9IGNodW5rc1swXS5yZWFkVUludDgoMylcblxuICAgIC8vIG5vdywgd2Ugc2hvdWxkIGhhdmUgbiBrZXlzIGZvbGxvd2VkIGJ5IGRhdGEgb2JqZWN0cyBmb3IgbGF0ZXIgdmVyc2lvbnMsIG90aGVyd2lzZSBhbGwga2V5cyBhbmQgb25lIGRhdGEgb2JqZWN0XG4gICAgaWYgKHRoaXMudmVyc2lvbiA8PSAwIHx8IFxuICAgICAgICB0aGlzLnZlcnNpb24gPiAzIHx8IFxuICAgICAgICB0aGlzLmV2YWxDb2RlIDwgMCB8fCBcbiAgICAgICAgdGhpcy5ldmFsQ29kZSA+IDB4MWEgfHwgLy8gdGhpcyBpcyB0aGUgbGFzdCB2YWxpZCBldmFsIGNvZGUgYXMgb2YgdmVyc2lvbiAzXG4gICAgICAgICh2ZXJzaW9uIDwgMyAmJiBuIDwgMSkgfHxcbiAgICAgICAgbiA+IDQgfHxcbiAgICAgICAgKHZlcnNpb24gPCAzICYmIG4gPj0gY2h1bmtzLmxlbmd0aCkgfHxcbiAgICAgICAgbiA+IGNodW5rcy5sZW5ndGgpXG4gICAge1xuICAgICAgY29uc29sZS5sb2coXCJpbnZhbGlkIGhlYWRlciB2YWx1ZXNcIiwgdGhpcylcbiAgICAgIHRoaXMudmVyc2lvbiA9IDBcbiAgICB9XG5cbiAgICAvLyBub3csIHdlIGhhdmUgY2h1bmtzIGxlZnQgdGhhdCBhcmUgZWl0aGVyIGRlc3RpbmF0aW9ucyBvciBkYXRhIHZlY3RvcnNcbiAgICBsaW1pdCA9IHRoaXMubiA9PSBjaHVua3MubGVuZ3RoID8gdGhpcy5uIDogdGhpcy5uICsgMTtcbiAgICB0aGlzLmRlc3RpbmF0aW9ucyA9IFtdXG4gICAgZm9yIChsb29wID0gMTsgdGhpcy52ZXJzaW9uICYmIGxvb3AgPCBsaW1pdDsgbG9vcCsrKVxuICAgIHtcbiAgICAgIG9uZURlc3QgPSBuZXcgVHhEZXN0aW5hdGlvbigpXG4gICAgICBvbmVEZXN0LmZyb21CdWZmZXIoY2h1bmtzW2xvb3BdKVxuICAgICAgaWYgKG9uZURlc3QuaXNWYWxpZCgpKVxuICAgICAge1xuICAgICAgICB0aGlzLmRlc3RpbmF0aW9ucy5wdXNoKG9uZURlc3QpXG4gICAgICB9XG4gICAgICBlbHNlXG4gICAgICB7XG4gICAgICAgIHRoaXMudmVyc2lvbiA9IDBcbiAgICAgIH1cbiAgICB9XG5cbiAgICBmb3IgKCA7IHRoaXMudmVyc2lvbiAmJiBsb29wIDwgY2h1bmtzLmxlbmd0aDsgbG9vcCsrKVxuICAgIHtcbiAgICAgIHRoaXMudkRhdGEucHVzaChjaHVua3NbbG9vcF0pIC8vIGlzIHRoaXMgYW4gaXNzdWUgdG8ganVzdCBzdG9yZSBhcyBpcyBmb3IgdGhlIGRhdGE/XG4gICAgfVxuXG4gICAgcmV0dXJuIG9mZnNldFxuICB9XG5cbiAgX19ieXRlTGVuZ3RoKClcbiAge1xuICAgIGNodW5rcyA9IFtCdWZmZXIuYWxsb2NVbnNhZmUoNCldXG4gICAgY2h1bmtzWzBdWzBdID0gdGhpcy52ZXJzaW9uXG4gICAgY2h1bmtzWzBdWzFdID0gdGhpcy5ldmFsQ29kZVxuICAgIGNodW5rc1swXVsyXSA9IHRoaXMubVxuICAgIGNodW5rc1swXVszXSA9IHRoaXMublxuICAgIHRoaXMuZGVzdGluYXRpb25zLmZvckVhY2goeCA9PiB7XG4gICAgICBjaHVua3MucHVzaChCdWZmZXIuYWxsb2NVbnNhZmUoeC5fX2J5dGVMZW5ndGgoKSkpXG4gICAgICB4LnRvQnVmZmVyKGNodW5rc1tjaHVua3MubGVuZ3RoIC0gMV0pXG4gICAgfSk7XG4gICAgdGhpcy52RGF0YS5mb3JFYWNoKHggPT4ge1xuICAgICAgY2h1bmtzLnB1c2goeClcbiAgICB9KTtcbiAgICByZXR1cm4gdmFyU2xpY2VTaXplKGJzY3JpcHQuY29tcGlsZShjaHVua3MpKVxuICB9XG5cbiAgdG9CdWZmZXIoYnVmZmVyLCBpbml0aWFsT2Zmc2V0KVxuICB7XG4gICAgdmFyIG9mZnNldCA9IGluaXRpYWxPZmZzZXQgfHwgMFxuICAgIGZ1bmN0aW9uIHdyaXRlU2xpY2UgKHNsaWNlKSB7IG9mZnNldCArPSBzbGljZS5jb3B5KGJ1ZmZlciwgb2Zmc2V0KSB9XG4gICAgZnVuY3Rpb24gd3JpdGVWYXJJbnQgKGkpIHtcbiAgICAgIHZhcnVpbnQuZW5jb2RlKGksIGJ1ZmZlciwgb2Zmc2V0KVxuICAgICAgb2Zmc2V0ICs9IHZhcnVpbnQuZW5jb2RlLmJ5dGVzXG4gICAgfVxuICAgIGZ1bmN0aW9uIHdyaXRlVmFyU2xpY2UgKHNsaWNlKSB7IHdyaXRlVmFySW50KHNsaWNlLmxlbmd0aCk7IHdyaXRlU2xpY2Uoc2xpY2UpIH1cblxuICAgIGNodW5rcyA9IFtCdWZmZXIuYWxsb2NVbnNhZmUoNCldXG4gICAgY2h1bmtzWzBdWzBdID0gdGhpcy52ZXJzaW9uXG4gICAgY2h1bmtzWzBdWzFdID0gdGhpcy5ldmFsQ29kZVxuICAgIGNodW5rc1swXVsyXSA9IHRoaXMubVxuICAgIGNodW5rc1swXVszXSA9IHRoaXMublxuICAgIHRoaXMuZGVzdGluYXRpb25zLmZvckVhY2goeCA9PiB7XG4gICAgICBjaHVua3MucHVzaChCdWZmZXIuYWxsb2NVbnNhZmUoeC5fX2J5dGVMZW5ndGgoKSkpXG4gICAgICB4LnRvQnVmZmVyKGNodW5rc1tjaHVua3MubGVuZ3RoIC0gMV0pXG4gICAgfSk7XG4gICAgdGhpcy52RGF0YS5mb3JFYWNoKHggPT4ge1xuICAgICAgY2h1bmtzLnB1c2goeClcbiAgICB9KTtcblxuICAgIHNjcmlwdFN0b3JlID0gYnNjcmlwdC5jb21waWxlKGNodW5rcylcbiAgICBpZiAoIWJ1ZmZlcikgYnVmZmVyID0gQnVmZmVyLmFsbG9jVW5zYWZlKHZhclNsaWNlU2l6ZShzY3JpcHRTdG9yZSkpXG4gICAgd3JpdGVWYXJTbGljZShzY3JpcHRTdG9yZSlcblxuICAgIC8vIGF2b2lkIHNsaWNpbmcgdW5sZXNzIG5lY2Vzc2FyeVxuICAgIGlmIChpbml0aWFsT2Zmc2V0ICE9PSB1bmRlZmluZWQpIHJldHVybiBidWZmZXIuc2xpY2UoaW5pdGlhbE9mZnNldCwgb2Zmc2V0KVxuICAgIC8vIFRPRE8gKGh0dHBzOi8vZ2l0aHViLmNvbS9CaXRHby9iaXRnby11dHhvLWxpYi9pc3N1ZXMvMTEpOiB3ZSBzaG91bGRuJ3QgaGF2ZSB0byBzbGljZSB0aGUgZmluYWwgYnVmZmVyXG4gICAgcmV0dXJuIGJ1ZmZlci5zbGljZSgwLCBvZmZzZXQpICAgIFxuICB9XG59XG5cbmZ1bmN0aW9uIGNoZWNrIChjaHVua3MsIGFsbG93SW5jb21wbGV0ZSlcbntcbiAgLy8gY2h1bmtzIGZvciBhIHNtYXJ0IHRyYW5zYWN0aW9uIHNob3VsZCBpbmNsdWRlIGEgcHVzaCBvZiBlaXRoZXIgYSBDQyBvciBlbXB0eS9tYXN0ZXIgQ09wdENDUGFyYW1zLCB0aGVuIGFuIE9QX0NIRUNLQ1JZUFRPQ09ORElUSU9OLFxuICAvLyB0aGVuIGEgcG90ZW50aWFsbHkgbmVzdGVkIENPcHRDQ1BhcmFtc1xuICAvLyB3ZSBhbHdheXMgc3RhcnQgYnkgZGVjb2RpbmcgdGhlIHNlY29uZCBDT3B0Q0NQYXJhbXMgZmlyc3QgdG8gZGV0ZXJtaW5lIGlmIHRoZSBmaXJzdCBvbmUgc2hvdWxkIGJlIGFuIG9wYXF1ZSBDQywgYXMgaXQgd2FzXG4gIC8vIGluIGVhcmxpZXIgdmVyc2lvbnMuIGlmIG5vdCwgaXQgaXMgYWRkZWQgdG8gdGhlIGVuZCBvZiB0aGUgZGF0YSBvYmplY3RzIG9mIHRoZSBmaXJzdCBwYXJhbXNcbiAgaWYgKGNodW5rcy5sZW5ndGggPD0gMiB8fFxuICAgICAgKGNodW5rc1tjaHVua3MubGVuZ3RoIC0gMV0gIT09IE9QUy5PUF9DSEVDS0NSWVBUT0NPTkRJVElPTiAmJiBjaHVua3NbY2h1bmtzLmxlbmd0aCAtIDFdICE9PSBPUFMuT1BfQ0hFQ0tDUllQVE9DT05ESVRJT05WRVJJRlkpKVxuICB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cbiAgb3B0Q0NQYXJhbXMgPSBuZXcgT3B0Q0NQYXJhbXMoKTtcbiAgb3B0Q0NQYXJhbXMuZnJvbUJ1ZmZlcihjaHVua3NbMl0pXG4gIGlmICghb3B0Q0NQYXJhbXMuaXNWYWxpZCgpKVxuICB7XG4gICAgcmV0dXJuIGZhbHNlXG4gIH1cblxuICAvLyBub3cgdmFsaWRhdGUgZXZhbCBjb2Rlcywgb2JqZWN0IHByZXNlbmNlLCBjdXJyZW5jaWVzLCB0eXBlcywgZXRjLlxuXG4gIHJldHVybiB0cnVlXG59XG5jaGVjay50b0pTT04gPSBmdW5jdGlvbiAoKSB7IHJldHVybiAnc21hcnQgdHJhbnNhY3Rpb24gb3V0cHV0JyB9XG5cbmZ1bmN0aW9uIGVuY29kZSAobSwgcHViS2V5cykge1xuICB0eXBlZm9yY2Uoe1xuICAgIG06IHR5cGVzLk51bWJlcixcbiAgICBwdWJLZXlzOiBbYnNjcmlwdC5pc0Nhbm9uaWNhbFB1YktleV1cbiAgfSwge1xuICAgIG06IG0sXG4gICAgcHViS2V5czogcHViS2V5c1xuICB9KVxuXG4gIHZhciBuID0gcHViS2V5cy5sZW5ndGhcbiAgaWYgKG4gPCBtKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdOb3QgZW5vdWdoIHB1YktleXMgcHJvdmlkZWQnKVxuXG4gIHJldHVybiBic2NyaXB0LmNvbXBpbGUoW10uY29uY2F0KFxuICAgIE9QX0lOVF9CQVNFICsgbSxcbiAgICBwdWJLZXlzLFxuICAgIE9QX0lOVF9CQVNFICsgbixcbiAgICBPUFMuT1BfQ0hFQ0tNVUxUSVNJR1xuICApKVxufVxuXG5mdW5jdGlvbiBkZWNvZGUgKGJ1ZmZlciwgYWxsb3dJbmNvbXBsZXRlKSB7XG4gIHZhciBjaHVua3MgPSBic2NyaXB0LmRlY29tcGlsZShidWZmZXIpXG4gIHR5cGVmb3JjZShjaGVjaywgY2h1bmtzLCBhbGxvd0luY29tcGxldGUpXG5cbiAgcmV0dXJuIHtcbiAgICBtOiBjaHVua3NbMF0gLSBPUF9JTlRfQkFTRSxcbiAgICBwdWJLZXlzOiBjaHVua3Muc2xpY2UoMSwgLTIpXG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGNoZWNrOiBjaGVjayxcbiAgZGVjb2RlOiBkZWNvZGUsXG4gIGVuY29kZTogZW5jb2RlXG59XG4iXX0=